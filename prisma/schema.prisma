generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id        String   @id @default(uuid())
  name      String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

model User {
  id                String             @id @default(uuid())
  email             String             @unique
  password          String
  name              String?
  role              String             @default("USER")
  emailVerified     Boolean            @default(false)
  approvedByAdmin   Boolean            @default(false)
  approvedAt        DateTime?
  approvedById      String?
  dateOfBirth       DateTime
  gender            String
  height            Float
  weight            Float
  sido              String
  guGun             String
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  deletedAt         DateTime?
  diseaseHistory    DiseaseHistory?
  healthCheckups    HealthCheckup[]
  userInterestGroup UserInterestGroup?
  approvedBy        User?              @relation("UserApprovals", fields: [approvedById], references: [id])
  approvedUsers     User[]             @relation("UserApprovals")

  @@map("users")
}

model EmailVerification {
  id         String    @id @default(uuid())
  email      String    @unique
  code       String
  expiresAt  DateTime
  verifiedAt DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@map("email_verifications")
}

model InstitutionConfig {
  id                         String  @id @default(uuid())
  name                       String  @unique
  emailForm                  String  @unique
  contactPersonName          String?
  contactPersonPhone         String?
  contactPersonEmail         String?
  businessRegistrationNumber String?
  pointPoolTotal             BigInt
  pointPoolRemaining         BigInt
  pointLimitPerUser          Int
  affiliationCodes           Json

  @@map("institution_configs")
}

model HealthCheckup {
  id                       String    @id @default(uuid())
  userId                   String
  checkupDate              DateTime?
  bmi                      Float?
  waistCircumference       Float?
  systolicBloodPressure    Int?
  diastolicBloodPressure   Int?
  totalCholesterol         Int?
  hdlCholesterol           Int?
  ldlCholesterol           Int?
  triglycerides            Int?
  hemoglobin               Float?
  ast                      Int?
  alt                      Int?
  serumCreatinine          Float?
  glomerularFiltrationRate Float?
  createdAt                DateTime  @default(now())
  updatedAt                DateTime  @updatedAt
  user                     User      @relation(fields: [userId], references: [id])

  @@map("health_checkups")
}

model DiseaseHistory {
  id                         String   @id @default(uuid())
  userId                     String   @unique
  chronicDiseases            String[] @default([])
  chronicRespiratoryDiseases String[] @default([])
  chronicRespiratoryOther    String?
  chronicArthritis           String[] @default([])
  osteoarthritis             String?
  chronicArthritisOther      String?
  pastChronicDiseases        String[] @default([])
  cancerHistory              String[] @default([])
  cancerOther                String?
  isSmoking                  String?
  isDrinking                 String?
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt
  user                       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("disease_histories")
}

model UserInterestGroup {
  id                     String               @id @default(uuid())
  userId                 String               @unique
  learningContentGroupId String
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt
  learningContentGroup   LearningContentGroup @relation(fields: [learningContentGroupId], references: [id], onDelete: Cascade)
  user                   User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_interest_groups")
}

model LearningContentGroup {
  id                 String              @id @default(uuid())
  name               String
  description        String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  deletedAt          DateTime?
  topics             Topic[]
  userInterestGroups UserInterestGroup[]

  @@map("learning_content_groups")
}

model Topic {
  id                     String               @id @default(uuid())
  learningContentGroupId String
  title                  String
  description            String?
  order                  Int
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt
  deletedAt              DateTime?
  contents               Content[]
  learningContentGroup   LearningContentGroup @relation(fields: [learningContentGroupId], references: [id], onDelete: Cascade)

  @@map("topics")
}

model Content {
  id        String    @id @default(uuid())
  topicId   String
  title     String
  order     Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  topic     Topic     @relation(fields: [topicId], references: [id], onDelete: Cascade)
  steps     Step[]

  @@map("contents")
}

model Step {
  id           String            @id @default(uuid())
  contentId    String
  pageTitle    String
  order        Int
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  deletedAt    DateTime?
  contentItems StepContentItem[]
  content      Content           @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@map("steps")
}

model StepContentItem {
  id        String          @id @default(uuid())
  stepId    String
  type      ContentItemType
  order     Int
  data      Json
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  deletedAt DateTime?
  step      Step            @relation(fields: [stepId], references: [id], onDelete: Cascade)

  @@map("step_content_items")
}

enum ContentItemType {
  SPEECH_BUBBLE
  TEXT
  IMAGE
  DATE
  LABEL_TEXT_FIELD
  CHECKBOX
  QNA
}
